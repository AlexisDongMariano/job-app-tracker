<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" , initial-scale="1">
    <title>Job App Tracker</title>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>

<body>
    <main style="max-width: 800px; margin: 40px auto; font-family: system-ui;">
        <h1>Job Application Tracker</h1>

        <h2>Add application</h2>

        <div id="add-error" style="color: #b00020; margin-bottom: 8px;"></div>

        <!-- <form method="post" action="/applications" hx-post="/applications" hx-target="#job-list" hx-swap="afterbegin"
            hx-on:htmx:afterRequest="this.reset()"
            hx-on:htmx:responseError="document.querySelector('#add-error').innerHTML = event.detail.xhr.responseText"> -->
        <form method="post" action="/applications" hx-post="/applications" hx-target="#job-list" hx-swap="afterbegin"
            hx-on:htmx:beforeRequest="document.querySelector('#add-error').innerHTML=''"
            hx-on:htmx:afterRequest="if(event.detail.successful) this.reset()">

            <div>
                <label>Company</label><br />
                <input type="text" name="company" oninput="document.querySelector('#add-error').innerHTML=''"
                    required />
            </div>

            <div>
                <label>Role</label><br />
                <input type="text" name="role" oninput="document.querySelector('#add-error').innerHTML=''" required />
            </div>

            <div>
                <label>Status</label><br />
                <select name="status">
                    <option>Applied</option>
                    <option>Interview</option>
                    <option>Offer</option>
                    <option>Rejected</option>
                </select>
            </div>

            <button type="submit">Add</button>
        </form>

        <hr />

        <p>This will list your applications.</p>

        <ul id="job-list">
            {% for app in job_applications %}
            {% include "_job_row.html" %}
            {% endfor %}
        </ul>

        {% if job_applications|length == 0 %}
        <p id="empty-state"><em>No applications yet.</em></p>
        {% endif %}

    </main>
</body>

</html>